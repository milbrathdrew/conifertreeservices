<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>External to Unqork Test</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">

  <script id="glance-cobrowse"
        charset="UTF-8"
        type="text/javascript"
        src="https://www.glancecdn.net/cobrowse/CobrowseJS.ashx?group=21483&site=staging"
        data-groupid="21483"
        data-site="staging"
        data-ws="www.glance.net"
        data-presence="on"
        data-cookietype="normal">
  </script>

  <style>
    :root {
      --bg-dark: #1a1d1a;
      --bg-card: rgba(42, 48, 42, 0.6);
      --accent: #7c9a6e;
      --accent-light: #a3c293;
      --text-primary: #e8ebe5;
      --text-muted: #9ca396;
      --grid-color: rgba(124, 154, 110, 0.12);
      --particle-color: #7c9a6e;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      background: var(--bg-dark);
      font-family: 'Inter', -apple-system, sans-serif;
      overflow: hidden;
    }

    /* 3D grid background - original implementation */
    .grid-bg {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image:
        linear-gradient(var(--grid-color) 1px, transparent 1px),
        linear-gradient(90deg, var(--grid-color) 1px, transparent 1px);
      background-size: 50px 50px;
      animation: gridMove 20s linear infinite;
      z-index: 0;
    }

    @keyframes gridMove {
      0% { transform: perspective(500px) rotateX(60deg) translateY(0); }
      100% { transform: perspective(500px) rotateX(60deg) translateY(50px); }
    }

    /* Floating particles */
    .particles {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 1;
      pointer-events: none;
    }

    .particle {
      position: absolute;
      background: var(--particle-color);
      border-radius: 50%;
      animation: float 35s infinite linear;
      opacity: 0;
    }

    .particle.sm { width: 3px; height: 3px; }
    .particle.md { width: 5px; height: 5px; }
    .particle.lg { width: 7px; height: 7px; }

    .particle:nth-child(1) { left: 5%; animation-delay: 0s; }
    .particle:nth-child(2) { left: 15%; animation-delay: 3s; }
    .particle:nth-child(3) { left: 25%; animation-delay: 6s; }
    .particle:nth-child(4) { left: 35%; animation-delay: 1s; }
    .particle:nth-child(5) { left: 45%; animation-delay: 8s; }
    .particle:nth-child(6) { left: 55%; animation-delay: 4s; }
    .particle:nth-child(7) { left: 65%; animation-delay: 10s; }
    .particle:nth-child(8) { left: 75%; animation-delay: 2s; }
    .particle:nth-child(9) { left: 85%; animation-delay: 7s; }
    .particle:nth-child(10) { left: 95%; animation-delay: 5s; }
    .particle:nth-child(11) { left: 10%; animation-delay: 9s; }
    .particle:nth-child(12) { left: 30%; animation-delay: 1.5s; }
    .particle:nth-child(13) { left: 50%; animation-delay: 11s; }
    .particle:nth-child(14) { left: 70%; animation-delay: 3.5s; }
    .particle:nth-child(15) { left: 90%; animation-delay: 6.5s; }

    @keyframes float {
      0% { transform: translateY(100vh); opacity: 0; }
      5% { opacity: 0.4; }
      95% { opacity: 0.4; }
      100% { transform: translateY(-100vh); opacity: 0; }
    }

    /* Main container */
    .container {
      position: relative;
      z-index: 10;
      text-align: center;
      padding: 48px 56px;
      background: var(--bg-card);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid rgba(124, 154, 110, 0.15);
      border-radius: 16px;
      max-width: 500px;
    }

    .badge {
      display: inline-block;
      padding: 6px 12px;
      font-size: 11px;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: var(--accent);
      background: rgba(124, 154, 110, 0.15);
      border-radius: 4px;
      margin-bottom: 20px;
    }

    h1 {
      font-size: 28px;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 8px;
      letter-spacing: -0.5px;
    }

    .subtitle {
      font-size: 14px;
      color: var(--text-muted);
      margin-bottom: 32px;
    }

    .btn {
      display: inline-block;
      padding: 14px 28px;
      font-family: 'Inter', sans-serif;
      font-size: 14px;
      font-weight: 500;
      color: var(--bg-dark);
      background: var(--accent);
      border: none;
      border-radius: 8px;
      cursor: pointer;
      text-decoration: none;
      transition: all 0.3s ease;
      margin-bottom: 32px;
    }

    .btn:hover {
      background: var(--accent-light);
    }

    .divider {
      height: 1px;
      background: rgba(124, 154, 110, 0.2);
      margin: 0 -56px 24px;
    }

    .env-label {
      font-size: 12px;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: var(--text-muted);
      margin-bottom: 16px;
    }

    .env-links {
      display: flex;
      gap: 12px;
      justify-content: center;
    }

    .env-link {
      padding: 10px 20px;
      font-family: 'Inter', sans-serif;
      font-size: 13px;
      font-weight: 500;
      color: var(--text-primary);
      background: transparent;
      border: 1px solid rgba(124, 154, 110, 0.3);
      border-radius: 6px;
      cursor: pointer;
      text-decoration: none;
      transition: all 0.2s ease;
    }

    .env-link:hover {
      border-color: var(--accent);
      background: rgba(124, 154, 110, 0.1);
    }

    @media (max-width: 600px) {
      .container {
        padding: 32px 24px;
        margin: 20px;
      }
      h1 { font-size: 24px; }
      .env-links { flex-direction: column; }
      .divider { margin: 0 -24px 24px; }
    }
  </style>
</head>
<body>
  <div class="grid-bg"></div>

  <div class="particles">
    <div class="particle sm"></div>
    <div class="particle md"></div>
    <div class="particle sm"></div>
    <div class="particle lg"></div>
    <div class="particle sm"></div>
    <div class="particle md"></div>
    <div class="particle sm"></div>
    <div class="particle lg"></div>
    <div class="particle md"></div>
    <div class="particle sm"></div>
    <div class="particle md"></div>
    <div class="particle sm"></div>
    <div class="particle lg"></div>
    <div class="particle sm"></div>
    <div class="particle md"></div>
  </div>

  <div class="container">
    <span class="badge">Glance Test</span>
    <h1>External Domain</h1>
    <p class="subtitle">Start a cobrowse session, then navigate to Unqork</p>

    <a href="#" id="start-cobrowse-jS" class="btn">Generate Agent Code</a>

    <div class="divider"></div>

    <p class="env-label">Select Environment</p>
    <div class="env-links">
      <a href="#" class="env-link cross-domain-link" data-env="staging">Staging</a>
      <a href="#" class="env-link cross-domain-link" data-env="qa-uat">QA-UAT</a>
      <a href="#" class="env-link cross-domain-link" data-env="uat">UAT</a>
    </div>
  </div>

  <script>
    function initializeGlanceHandlers() {
      const glanceButton = document.getElementById('start-cobrowse-jS');

      if (glanceButton) {
        glanceButton.addEventListener('click', function (e) {
          e.preventDefault();

          if (window.GLANCE?.Cobrowse?.Visitor?.startSession) {
            GLANCE.Cobrowse.Visitor.startSession({
              sessionKey: "GLANCE_KEYTYPE_RANDOM",
              customData: {
                cleanUrl: window.location.origin + window.location.pathname
              }
            });
          } else {
            console.error("Glance Cobrowse is not ready or has not been loaded yet.");
          }
        });
      } else {
          console.error("Could not find the Glance trigger element '#start-cobrowse-jS'.");
      }

      const destinations = {
        'staging': 'https://american-equity-stagingx.unqork.io/app/financial-viability#/display/suitability',
        'qa-uat': 'https://american-equity-qa-uatx.unqork.io/app/financial-viability#/display/suitability',
        'uat': 'https://american-equity-uatx.unqork.io/app/financial-viability#/display/suitability'
      };

      const crossDomainLinks = document.querySelectorAll('.cross-domain-link');
      crossDomainLinks.forEach(function(link) {
        link.addEventListener('click', function(e) {
          e.preventDefault();
          const env = this.getAttribute('data-env');
          const destination = destinations[env];

          console.log("Link clicked for environment:", env, "Checking for active Glance session...");

          if (window.GLANCE?.Cobrowse?.Visitor?.inSession()) {
            console.log("Session is active. Calling crossDomain() and waiting for it to complete...");

            GLANCE.Cobrowse.Visitor.crossDomain().then(function() {
              console.log("crossDomain() completed successfully. Navigating now.");
              window.open(destination, "_blank");
            }).catch(function(error) {
              console.error("The crossDomain() process failed.", error);
              window.open(destination, "_blank");
            });

          } else {
            console.error("No active session found. Navigating directly.");
            window.open(destination, '_blank');
          }
        });
      });
    }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initializeGlanceHandlers);
    } else {
      initializeGlanceHandlers();
    }

    window.addEventListener('glance_cobrowse_loaded', function() {
      console.log("Glance Cobrowse script loaded and ready");
    });
  </script>
</body>
</html>
