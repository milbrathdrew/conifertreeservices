<!DOCTYPE html>
<html>
<head>
  <title>External to Unqork Test</title>
</head>
<body>
  <p><strong>External â†’ Unqork Setup:</strong> Using helper.html for testing, removed script from index.html</p>
  <h1>External Domain (Origin)</h1>
  <p>Starting cobrowse session here, then navigating to Unqork destination.</p>
  
  <a href="#" id="start-cobrowse-jS">Generate Agent Code</a>
  <br><br>
  <a href="#" id="cross-domain-link" style="color: blue; text-decoration: underline; cursor: pointer;">Go to Unqork Test Domain</a>


  <script>
    const glanceButton = document.getElementById('start-cobrowse-jS');
    
    if (glanceButton) {
      glanceButton.addEventListener('click', function (e) {
        e.preventDefault();
    
        if (window.GLANCE?.Cobrowse?.Visitor?.startSession) {
          GLANCE.Cobrowse.Visitor.startSession("GLANCE_KEYTYPE_RANDOM", {
            customData: {
              cleanUrl: window.location.origin + window.location.pathname
            }
          });
        } else {
          console.error("Glance Cobrowse is not ready or has not been loaded yet.");
        }
      });
    } else {
        console.error("Could not find the Glance trigger element '#start-cobrowse-jS'.");
    }

    document.getElementById('cross-domain-link').addEventListener('click', function(e) {
      e.preventDefault();
      const destination = "https://auxox.unqork.io/#/display/6861c69799f508f322d80fd9";

      console.log("Link clicked. Checking for active Glance session...");

      if (window.GLANCE?.Cobrowse?.Visitor?.inSession()) {
        console.log("Session is active. Calling crossDomain() and waiting for it to complete...");
        
        GLANCE.Cobrowse.Visitor.crossDomain().then(function() {
          console.log("crossDomain() completed successfully. Navigating now.");
          window.open(destination, "_blank");
        }).catch(function(error) {
          console.error("The crossDomain() process failed.", error);
          window.open(destination, "_blank");
        });

      } else {
        console.error("No active session found. Navigating directly.");
        window.open(destination, '_blank');
      }
    });
  </script>

</body>
</html>
